<div class="order">
    <h4>Your Order</h4>
    <div class="order-items"></div>

    {% include 'items/includes/order-summary.html' %}
</div>

<script type="text/javascript">
    setUpOrder();

     $('body').on('click', '.remove', function() {
        let orderItemId = $(this).parent().siblings('.orderItemId').val();

        if(confirm('Are you sure you want to remove item from the order?')){
            fetch(`/orderitem/${orderItemId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken,
                },
            })
            .then(() => {
                getOrderItems();
            });
        }
    })

    $('body').on('change', '.update', function() {
        let orderItemId = $(this).parent().siblings('.orderItemId').val();
        let quantity = $(this).val();

        fetch(`/orderitem/${orderItemId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken,
            },
            body: JSON.stringify({ quantity: quantity})
        })
        .then(response => response.json())
        .then(data => {
            if( data.error ){
                alert(data.error);
            }
            else{
                getOrderItems(data);
            }
        })
    })
</script>
